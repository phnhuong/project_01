# Use Case Specification - Hệ Thống Quản Lý Học Sinh

---

## Thông Tin Tài Liệu

**Dự án:** Hệ Thống Quản Lý Học Sinh  
**Phiên bản:** 1.0  
**Ngày tạo:** 31/01/2026  
**Trạng thái:** Draft

---

## Mục Lục

1. [Actors](#1-actors)
2. [Use Case Diagram](#2-use-case-diagram)
3. [Use Case Descriptions](#3-use-case-descriptions)
   - [Module Authentication](#module-1-authentication)
   - [Module Quản Lý Học Sinh](#module-2-quản-lý-học-sinh)
   - [Module Quản Lý Điểm Số](#module-3-quản-lý-điểm-số)
   - [Module Báo Cáo & Thống Kê](#module-4-báo-cáo--thống-kê)
   - [Module Import/Export](#module-5-importexport)
4. [Activity Diagrams](#4-activity-diagrams)
5. [Sequence Diagrams](#5-sequence-diagrams)
6. [Business Rules](#6-business-rules)
7. [Data Dictionary](#7-data-dictionary)

---

## 1. Actors

### 1.1 Primary Actors (Người dùng chính)

#### Actor: Giáo Viên Chủ Nhiệm
**Mô tả:** Giáo viên quản lý một lớp học cụ thể  
**Quyền hạn:**
- Quản lý thông tin học sinh (CRUD)
- Nhập và quản lý điểm số
- Xem báo cáo và thống kê
- Import/Export dữ liệu
- Xếp hạng học sinh

**Mục tiêu kinh doanh:**
- Quản lý lớp học hiệu quả
- Tiết kiệm thời gian xử lý dữ liệu
- Theo dõi tiến độ học tập

---

#### Actor: Giáo Viên Bộ Môn
**Mô tả:** Giáo viên dạy môn học cụ thể cho nhiều lớp  
**Quyền hạn:**
- Nhập điểm cho môn học của mình
- Xem thống kê điểm môn học
- Export điểm môn học

**Mục tiêu kinh doanh:**
- Nhập điểm nhanh cho nhiều lớp
- Đánh giá chất lượng giảng dạy

---

#### Actor: Ban Giám Hiệu
**Mô tả:** Quản lý cấp cao của nhà trường  
**Quyền hạn:**
- Xem tất cả báo cáo
- Xem dashboard tổng quan
- Export báo cáo tổng hợp
- Read-only access

**Mục tiêu kinh doanh:**
- Giám sát chất lượng giáo dục
- Báo cáo lên cấp trên

---

### 1.2 Secondary Actors (Hệ thống phụ)

#### Actor: Email Service
**Mô tả:** Hệ thống gửi email tự động  
**Chức năng:**
- Gửi email reset password
- Gửi thông báo (future)

---

#### Actor: Database System
**Mô tả:** PostgreSQL database  
**Chức năng:**
- Lưu trữ dữ liệu
- Backup tự động

---

## 2. Use Case Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│                  HỆ THỐNG QUẢN LÝ HỌC SINH                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────┐                                              │
│  │  Giáo Viên   │                                              │
│  │ Chủ Nhiệm    │──────┐                                       │
│  └──────────────┘      │                                       │
│                        │                                       │
│                        ├──(UC-01) Đăng nhập                    │
│                        ├──(UC-02) Quản lý học sinh             │
│                        │    ├── (UC-02.1) Thêm học sinh        │
│                        │    ├── (UC-02.2) Sửa học sinh         │
│                        │    ├── (UC-02.3) Xóa học sinh         │
│                        │    ├── (UC-02.4) Tìm kiếm học sinh    │
│                        │    └── (UC-02.5) Xem danh sách HS     │
│                        │                                       │
│                        ├──(UC-03) Quản lý điểm số              │
│                        │    ├── (UC-03.1) Nhập điểm            │
│                        │    ├── (UC-03.2) Sửa điểm             │
│                        │    ├── (UC-03.3) Xóa điểm             │
│                        │    └── (UC-03.4) Nhập điểm hàng loạt  │
│                        │                                       │
│                        ├──(UC-04) Xem báo cáo                  │
│                        │    ├── (UC-04.1) Dashboard            │
│                        │    ├── (UC-04.2) Báo cáo cá nhân      │
│                        │    ├── (UC-04.3) Báo cáo lớp học      │
│                        │    └── (UC-04.4) Bảng xếp hạng        │
│                        │                                       │
│                        └──(UC-05) Import/Export dữ liệu        │
│                             ├── (UC-05.1) Import học sinh      │
│                             ├── (UC-05.2) Import điểm          │
│                             ├── (UC-05.3) Export học sinh      │
│                             └── (UC-05.4) Export điểm          │
│                                                                 │
│  ┌──────────────┐                                              │
│  │  Giáo Viên   │                                              │
│  │  Bộ Môn      │──────(UC-01) Đăng nhập                       │
│  └──────────────┘      (UC-03.1) Nhập điểm môn học             │
│                        (UC-04.5) Thống kê môn học              │
│                                                                 │
│  ┌──────────────┐                                              │
│  │ Ban Giám Hiệu│──────(UC-01) Đăng nhập                       │
│  └──────────────┘      (UC-04) Xem báo cáo (Read-only)         │
│                                                                 │
│                 ┌──────────────────┐                           │
│                 │  Email Service   │◄──(UC-06) Reset Password  │
│                 └──────────────────┘                           │
│                                                                 │
│                 ┌──────────────────┐                           │
│                 │ Database System  │◄──All Use Cases           │
│                 └──────────────────┘                           │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. Use Case Descriptions

---

## MODULE 1: AUTHENTICATION

### UC-01: Đăng Nhập Hệ Thống

**Use Case ID:** UC-01  
**Use Case Name:** Đăng nhập hệ thống  
**Priority:** Critical  
**Actor:** Giáo Viên Chủ Nhiệm, Giáo Viên Bộ Môn, Ban Giám Hiệu

---

#### Mô Tả Ngắn Gọn
Người dùng đăng nhập vào hệ thống bằng username và password để truy cập các chức năng

#### Điều Kiện Tiên Quyết
- Hệ thống đang hoạt động
- Người dùng đã có tài khoản được cấp bởi admin

#### Điều Kiện Sau
- Người dùng được xác thực và nhận token
- Session được tạo
- Chuyển hướng đến Dashboard

---

#### Luồng Chính (Main Flow)

| Bước | Actor | System |
|------|-------|--------|
| 1 | Truy cập URL hệ thống | Hiển thị trang đăng nhập |
| 2 | Nhập username | Validate format |
| 3 | Nhập password | |
| 4 | Click button "Đăng nhập" | Hiển thị loading indicator |
| 5 | | Gửi request POST /api/auth/login |
| 6 | | Validate thông tin đăng nhập |
| 7 | | Hash password và so sánh với DB |
| 8 | | Tạo JWT token |
| 9 | | Lưu token vào database |
| 10 | | Response: {token, user_info} |
| 11 | | Lưu token vào localStorage |
| 12 | | Redirect đến Dashboard |
| 13 | Xem Dashboard | Hiển thị giao diện Dashboard |

---

#### Luồng Thay Thế (Alternative Flows)

**A1: Username không tồn tại**
- Tại bước 7:
  - System: Hiển thị lỗi "Tài khoản không tồn tại"
  - Actor: Quay lại bước 2

**A2: Password sai**
- Tại bước 7:
  - System: Hiển thị lỗi "Mật khẩu không đúng"
  - System: Log failed attempt
  - Actor: Quay lại bước 3

**A3: Tài khoản bị khóa**
- Tại bước 7:
  - System: Hiển thị lỗi "Tài khoản đã bị khóa. Vui lòng liên hệ admin"
  - Use case kết thúc

**A4: Quá nhiều lần đăng nhập sai (>5 lần trong 15 phút)**
- Tại bước 7:
  - System: Khóa tạm thời tài khoản 15 phút
  - System: Hiển thị "Tài khoản tạm thời bị khóa do nhập sai quá nhiều lần"
  - Use case kết thúc

---

#### Luồng Ngoại Lệ (Exception Flows)

**E1: Lỗi kết nối database**
- System: Hiển thị "Không thể kết nối đến server. Vui lòng thử lại sau"
- System: Log error
- Use case kết thúc

**E2: Lỗi network**
- System: Hiển thị "Lỗi kết nối mạng. Vui lòng kiểm tra internet"
- Use case kết thúc

---

#### Business Rules
- **BR-01:** Username không phân biệt hoa thường
- **BR-02:** Password phải có ít nhất 6 ký tự
- **BR-03:** Token có thời hạn 7 ngày
- **BR-04:** Sau 5 lần đăng nhập sai, khóa tài khoản 15 phút
- **BR-05:** Session timeout sau 24 giờ không hoạt động

#### Non-Functional Requirements
- Response time < 2 giây
- Mã hóa password bằng bcrypt (10 rounds)
- HTTPS bắt buộc
- Token lưu trữ an toàn (httpOnly cookie hoặc localStorage)

#### UI Requirements
- Form centered trên màn hình
- Show/hide password toggle
- Remember me checkbox (optional)
- Link "Quên mật khẩu"
- Responsive design

---

### UC-02: Đăng Xuất Hệ Thống

**Use Case ID:** UC-02  
**Use Case Name:** Đăng xuất  
**Priority:** High  
**Actor:** All authenticated users

---

#### Mô Tả Ngắn Gọn
Người dùng đăng xuất khỏi hệ thống để kết thúc phiên làm việc

#### Điều Kiện Tiên Quyết
- Người dùng đã đăng nhập

#### Điều Kiện Sau
- Token bị vô hiệu hóa
- Session bị xóa
- Chuyển về trang đăng nhập

---

#### Luồng Chính

| Bước | Actor | System |
|------|-------|--------|
| 1 | Click menu "Đăng xuất" | Hiển thị confirmation dialog |
| 2 | Click "Xác nhận" | Gửi request POST /api/auth/logout |
| 3 | | Xóa token khỏi database |
| 4 | | Clear localStorage/cookies |
| 5 | | Response success |
| 6 | | Redirect đến trang login |
| 7 | Xem trang đăng nhập | |

---

#### Luồng Thay Thế

**A1: User hủy đăng xuất**
- Tại bước 2:
  - Actor: Click "Hủy"
  - System: Đóng dialog
  - Use case kết thúc

---

#### Business Rules
- **BR-06:** Token bị blacklist sau khi logout
- **BR-07:** Không thể sử dụng token cũ để truy cập

---

### UC-03: Quên Mật Khẩu

**Use Case ID:** UC-03  
**Use Case Name:** Reset mật khẩu  
**Priority:** Medium  
**Actor:** Giáo Viên, Email Service

---

#### Mô Tả Ngắn Gọn
Người dùng reset mật khẩu khi quên bằng cách nhận link qua email

#### Điều Kiện Tiên Quyết
- Người dùng có email đăng ký trong hệ thống
- Email service hoạt động

#### Điều Kiện Sau
- Email reset được gửi
- User có thể đặt mật khẩu mới

---

#### Luồng Chính

| Bước | Actor | System |
|------|-------|--------|
| 1 | Click "Quên mật khẩu" | Hiển thị form nhập email |
| 2 | Nhập email | Validate email format |
| 3 | Click "Gửi" | Hiển thị loading |
| 4 | | Kiểm tra email có trong DB |
| 5 | | Tạo reset token (UUID) |
| 6 | | Lưu token vào DB với expiry = 1 giờ |
| 7 | | Gửi email với link reset |
| 8 | | Hiển thị "Email đã được gửi" |
| 9 | Mở email | |
| 10 | Click link trong email | Validate token |
| 11 | | Hiển thị form đặt mật khẩu mới |
| 12 | Nhập password mới (2 lần) | Validate password match |
| 13 | Click "Lưu" | Hash password mới |
| 14 | | Cập nhật DB |
| 15 | | Xóa reset token |
| 16 | | Hiển thị "Đổi mật khẩu thành công" |
| 17 | | Redirect đến login |

---

#### Luồng Thay Thế

**A1: Email không tồn tại**
- Tại bước 4:
  - System: Vẫn hiển thị "Email đã được gửi" (bảo mật)
  - Không gửi email thực sự
  - Use case kết thúc

**A2: Token hết hạn**
- Tại bước 10:
  - System: Hiển thị "Link đã hết hạn. Vui lòng yêu cầu lại"
  - Use case kết thúc

**A3: Token không hợp lệ**
- Tại bước 10:
  - System: Hiển thị "Link không hợp lệ"
  - Use case kết thúc

**A4: Password mới không match**
- Tại bước 12:
  - System: Hiển thị "Mật khẩu không khớp"
  - Quay lại bước 12

---

#### Business Rules
- **BR-08:** Reset token hết hạn sau 1 giờ
- **BR-09:** Token chỉ dùng được 1 lần
- **BR-10:** Password mới khác password cũ (optional)
- **BR-11:** Password tối thiểu 6 ký tự

---

## MODULE 2: QUẢN LÝ HỌC SINH

### UC-04: Xem Danh Sách Học Sinh

**Use Case ID:** UC-04  
**Use Case Name:** Xem danh sách học sinh  
**Priority:** Critical  
**Actor:** Giáo Viên Chủ Nhiệm

---

#### Mô Tả Ngắn Gọn
Giáo viên xem danh sách tất cả học sinh trong lớp với các thông tin cơ bản

#### Điều Kiện Tiên Quyết
- Người dùng đã đăng nhập
- Có ít nhất 1 học sinh trong lớp

#### Điều Kiện Sau
- Danh sách học sinh được hiển thị với pagination

---

#### Luồng Chính

| Bước | Actor | System |
|------|-------|--------|
| 1 | Click menu "Học sinh" | Hiển thị loading skeleton |
| 2 | | Gửi GET /api/students?page=1&limit=20 |
| 3 | | Query database |
| 4 | | Tính điểm TB và xếp hạng (nếu chưa có) |
| 5 | | Response: {students: [], total, page, totalPages} |
| 6 | | Render table với data |
| 7 | Xem danh sách | Hiển thị bảng với cột: STT, Mã HS, Họ tên, Ngày sinh, Giới tính, ĐTB, Hạng |
| 8 | | Hiển thị pagination |

---

#### Luồng Thay Thế

**A1: Không có học sinh nào**
- Tại bước 3:
  - System: Response students = []
  - System: Hiển thị empty state
  - System: Hiển thị button "Thêm học sinh đầu tiên"

**A2: Chuyển trang**
- Tại bước 8:
  - Actor: Click số trang hoặc Next/Previous
  - System: Gửi GET /api/students?page=N
  - Quay lại bước 3

---

#### Business Rules
- **BR-12:** Mặc định 20 học sinh/trang
- **BR-13:** Sort mặc định theo tên A-Z
- **BR-14:** Chỉ hiển thị học sinh chưa bị xóa (is_deleted = false)

#### UI Requirements
- Table responsive
- Zebra striping
- Hover effect
- Loading skeleton khi fetch data

---

### UC-05: Tìm Kiếm Học Sinh

**Use Case ID:** UC-05  
**Use Case Name:** Tìm kiếm học sinh  
**Priority:** High  
**Actor:** Giáo Viên Chủ Nhiệm

**Include:** UC-04 (Xem danh sách học sinh)

---

#### Mô Tả Ngắn Gọn
Giáo viên tìm kiếm học sinh theo tên hoặc mã số

#### Điều Kiện Tiên Quyết
- Đã vào trang danh sách học sinh
- Có ít nhất 1 học sinh

#### Điều Kiện Sau
- Kết quả tìm kiếm được hiển thị

---

#### Luồng Chính

| Bước | Actor | System |
|------|-------|--------|
| 1 | Nhập từ khóa vào search box | Debounce 300ms |
| 2 | | Gửi GET /api/students?search=keyword |
| 3 | | Query DB với ILIKE '%keyword%' |
| 4 | | Response danh sách match |
| 5 | | Highlight keyword trong kết quả |
| 6 | Xem kết quả tìm kiếm | |

---

#### Luồng Thay Thế

**A1: Không tìm thấy kết quả**
- Tại bước 4:
  - System: Response students = []
  - System: Hiển thị "Không tìm thấy học sinh nào"

**A2: Clear search**
- Actor: Click icon X hoặc xóa hết text
- System: Load lại danh sách đầy đủ
- Include UC-04

---

#### Business Rules
- **BR-15:** Tìm kiếm không phân biệt hoa thường
- **BR-16:** Tìm kiếm theo tên hoặc mã học sinh
- **BR-17:** Debounce 300ms để tránh spam request

---

### UC-06: Thêm Học Sinh Mới

**Use Case ID:** UC-06  
**Use Case Name:** Thêm học sinh mới  
**Priority:** Critical  
**Actor:** Giáo Viên Chủ Nhiệm

---

#### Mô Tả Ngắn Gọn
Giáo viên thêm học sinh mới vào lớp học

#### Điều Kiện Tiên Quyết
- Đã đăng nhập với quyền Giáo Viên Chủ Nhiệm

#### Điều Kiện Sau
- Học sinh mới được lưu vào database
- Danh sách được cập nhật

---

#### Luồng Chính

| Bước | Actor | System |
|------|-------|--------|
| 1 | Click button "Thêm học sinh" | Hiển thị modal form |
| 2 | | Auto-focus vào field "Mã học sinh" |
| 3 | Nhập mã học sinh | Validate real-time (unique) |
| 4 | Nhập họ và tên | Validate (2-100 ký tự) |
| 5 | Chọn ngày sinh | Validate (>= 5 tuổi, <= ngày hiện tại) |
| 6 | Chọn giới tính | Dropdown (Nam/Nữ) |
| 7 | Nhập địa chỉ (optional) | |
| 8 | Nhập SĐT phụ huynh (optional) | Validate (10 số, bắt đầu 0) |
| 9 | Nhập email phụ huynh (optional) | Validate email format |
| 10 | Nhập ghi chú (optional) | |
| 11 | Click "Lưu" | Validate tất cả fields |
| 12 | | Hiển thị loading spinner |
| 13 | | Gửi POST /api/students |
| 14 | | Insert vào database |
| 15 | | Response: {success, student_data} |
| 16 | | Đóng modal |
| 17 | | Hiển thị success toast |
| 18 | | Refresh danh sách (optimistic update) |

---

#### Luồng Thay Thế

**A1: Mã học sinh đã tồn tại**
- Tại bước 14:
  - System: Response error 400
  - System: Hiển thị lỗi "Mã học sinh đã tồn tại"
  - Actor: Quay lại bước 3

**A2: Validation failed**
- Tại bước 11:
  - System: Highlight các field lỗi màu đỏ
  - System: Hiển thị message lỗi dưới mỗi field
  - Actor: Sửa lỗi và quay lại bước 11

**A3: Hủy thêm học sinh**
- Tại bất kỳ bước nào:
  - Actor: Click "Hủy" hoặc click outside modal
  - System: Hiển thị confirmation nếu có data đã nhập
  - Actor: Confirm
  - System: Đóng modal
  - Use case kết thúc

**A4: Click ESC**
- Tại bất kỳ bước nào:
  - Actor: Nhấn ESC
  - System: Tương tự A3

---

#### Business Rules
- **BR-18:** Mã học sinh unique trong toàn bộ hệ thống
- **BR-19:** Mã học sinh không chứa ký tự đặc biệt
- **BR-20:** Họ tên từ 2-100 ký tự
- **BR-21:** Ngày sinh: học sinh >= 5 tuổi
- **BR-22:** SĐT: đúng 10 số, bắt đầu bằng 0
- **BR-23:** Email: format chuẩn RFC 5322

#### Validation Rules
```javascript
{
  student_code: {
    required: true,
    pattern: /^[A-Z0-9]+$/,
    unique: true
  },
  full_name: {
    required: true,
    minLength: 2,
    maxLength: 100
  },
  date_of_birth: {
    required: true,
    min: new Date() - 25 years,
    max: new Date() - 5 years
  },
  gender: {
    required: true,
    enum: ['Nam', 'Nữ']
  },
  parent_phone: {
    required: false,
    pattern: /^0\d{9}$/
  },
  parent_email: {
    required: false,
    pattern: /^[^\s@]+@[^\s@]+\.[^\s@]+$/
  }
}
```

---

### UC-07: Sửa Thông Tin Học Sinh

**Use Case ID:** UC-07  
**Use Case Name:** Cập nhật thông tin học sinh  
**Priority:** Critical  
**Actor:** Giáo Viên Chủ Nhiệm

**Extend:** UC-06 (Thêm học sinh)

---

#### Mô Tả Ngắn Gọn
Giáo viên chỉnh sửa thông tin của học sinh đã tồn tại

#### Điều Kiện Tiên Quyết
- Học sinh đã tồn tại trong hệ thống
- Người dùng có quyền sửa

#### Điều Kiện Sau
- Thông tin học sinh được cập nhật
- Lịch sử thay đổi được log

---

#### Luồng Chính

| Bước | Actor | System |
|------|-------|--------|
| 1 | Click icon "Sửa" trên row học sinh | Hiển thị loading |
| 2 | | Gửi GET /api/students/:id |
| 3 | | Response student data |
| 4 | | Pre-fill form với dữ liệu hiện tại |
| 5 | | Disable field "Mã học sinh" |
| 6 | Sửa các field cần thiết | Validate real-time |
| 7 | Click "Lưu" | Validate all fields |
| 8 | | So sánh với dữ liệu cũ |
| 9 | | Nếu có thay đổi lớn, hiển thị confirmation |
| 10 | Confirm | |
| 11 | | Gửi PUT /api/students/:id |
| 12 | | Update database |
| 13 | | Log audit trail (old_value, new_value, user, timestamp) |
| 14 | | Response success |
| 15 | | Đóng modal |
| 16 | | Update row trong bảng (optimistic) |
| 17 | | Hiển thị success message |

---

#### Luồng Thay Thế

**A1: Không có thay đổi nào**
- Tại bước 8:
  - System: Hiển thị "Không có thay đổi nào"
  - System: Đóng modal
  - Use case kết thúc

**A2: Thay đổi lớn (ví dụ: đổi tên hoàn toàn)**
- Tại bước 9:
  - System: Hiển thị confirmation
  - System: "Bạn đang thay đổi [field] từ [old] sang [new]. Xác nhận?"
  - Actor: Click "Xác nhận"
  - Tiếp tục bước 11

**A3: Validation failed**
- Tại bước 7:
  - System: Tương tự UC-06 A2

---

#### Business Rules
- **BR-24:** Không cho phép sửa mã học sinh
- **BR-25:** Log tất cả thay đổi vào audit_log table
- **BR-26:** Validate giống UC-06

---

### UC-08: Xóa Học Sinh

**Use Case ID:** UC-08  
**Use Case Name:** Xóa học sinh  
**Priority:** High  
**Actor:** Giáo Viên Chủ Nhiệm

---

#### Mô Tả Ngắn Gọn
Giáo viên xóa học sinh khỏi danh sách (soft delete)

#### Điều Kiện Tiên Quyết
- Học sinh tồn tại và chưa bị xóa
- Người dùng có quyền xóa

#### Điều Kiện Sau
- Học sinh bị đánh dấu is_deleted = true
- Dữ liệu điểm vẫn được giữ
- Học sinh biến mất khỏi danh sách

---

#### Luồng Chính

| Bước | Actor | System |
|------|-------|--------|
| 1 | Click icon "Xóa" trên row | Hiển thị confirmation dialog |
| 2 | | "Bạn có chắc muốn xóa học sinh [Tên]?" |
| 3 | | "Thao tác này có thể được hoàn tác" |
| 4 | Click "Xác nhận" | Gửi DELETE /api/students/:id |
| 5 | | Set is_deleted = true trong DB |
| 6 | | Giữ nguyên dữ liệu điểm (cascade = false) |
| 7 | | Log action |
| 8 | | Response success |
| 9 | | Remove row khỏi table (animation) |
| 10 | | Hiển thị success toast |
| 11 | | Cập nhật tổng số học sinh |

---

#### Luồng Thay Thế

**A1: Hủy xóa**
- Tại bước 4:
  - Actor: Click "Hủy"
  - System: Đóng dialog
  - Use case kết thúc

**A2: Học sinh đã bị xóa trước đó**
- Tại bước 5:
  - System: Response error 404
  - System: "Học sinh không tồn tại hoặc đã bị xóa"
  - System: Refresh danh sách

---

#### Business Rules
- **BR-27:** Soft delete (is_deleted = true)
- **BR-28:** Giữ lại tất cả dữ liệu điểm
- **BR-29:** Có thể khôi phục (UC-09)
- **BR-30:** Log action để audit

---

### UC-09: Khôi Phục Học Sinh Đã Xóa

**Use Case ID:** UC-09  
**Use Case Name:** Khôi phục học sinh  
**Priority:** Medium  
**Actor:** Giáo Viên Chủ Nhiệm

---

#### Mô Tả Ngắn Gọn
Giáo viên khôi phục học sinh đã xóa nhầm

#### Điều Kiện Tiên Quyết
- Học sinh đã bị soft delete (is_deleted = true)

#### Điều Kiện Sau
- Học sinh xuất hiện lại trong danh sách chính

---

#### Luồng Chính

| Bước | Actor | System |
|------|-------|--------|
| 1 | Click menu "Học sinh đã xóa" | Gửi GET /api/students?deleted=true |
| 2 | | Response danh sách học sinh đã xóa |
| 3 | | Hiển thị table tương tự danh sách chính |
| 4 | Click "Khôi phục" trên row | Hiển thị confirmation |
| 5 | | "Bạn muốn khôi phục học sinh [Tên]?" |
| 6 | Click "Xác nhận" | Gửi POST /api/students/:id/restore |
| 7 | | Set is_deleted = false |
| 8 | | Log action |
| 9 | | Response success |
| 10 | | Remove khỏi bảng đã xóa |
| 11 | | Hiển thị success message |

---

#### Business Rules
- **BR-31:** Chỉ giáo viên chủ nhiệm mới có quyền restore
- **BR-32:** Tất cả dữ liệu cũ được giữ nguyên

---

## MODULE 3: QUẢN LÝ ĐIỂM SỐ

### UC-10: Nhập Điểm Cho Học Sinh

**Use Case ID:** UC-10  
**Use Case Name:** Nhập điểm  
**Priority:** Critical  
**Actor:** Giáo Viên Chủ Nhiệm, Giáo Viên Bộ Môn

---

#### Mô Tả Ngắn Gọn
Giáo viên nhập điểm cho học sinh theo môn học và loại điểm

#### Điều Kiện Tiên Quyết
- Đã có học sinh trong lớp
- Người dùng đã chọn môn học, loại điểm, học kỳ

#### Điều Kiện Sau
- Điểm được lưu vào database
- Điểm TB và xếp hạng được tự động cập nhật

---

#### Luồng Chính

| Bước | Actor | System |
|------|-------|--------|
| 1 | Click menu "Điểm số" | Hiển thị page quản lý điểm |
| 2 | Chọn môn học từ dropdown | Update state |
| 3 | Chọn loại điểm (KTM/KT15/KT1T/THHK) | Update state |
| 4 | Chọn học kỳ (HK1/HK2) | Update state |
| 5 | | Gửi GET /api/students |
| 6 | | Response danh sách học sinh |
| 7 | | Gửi GET /api/scores?subject=X&type=Y |
| 8 | | Response điểm đã có (nếu có) |
| 9 | | Render bảng: STT, Mã HS, Họ tên, Điểm |
| 10 | | Pre-fill điểm đã có vào input |
| 11 | Click vào ô điểm | Focus vào input, select text |
| 12 | Nhập điểm (0-10) | Validate real-time |
| 13 | Blur hoặc Enter | Auto-save (debounce 500ms) |
| 14 | | Gửi POST /api/scores |
| 15 | | Insert/Update database |
| 16 | | Response success |
| 17 | | Hiển thị checkmark icon |
| 18 | | Trigger tính lại điểm TB (async) |
| 19 | Tiếp tục nhập điểm khác | Repeat bước 11-18 |

---

#### Luồng Thay Thế

**A1: Điểm không hợp lệ**
- Tại bước 12:
  - System: Highlight input màu đỏ
  - System: Hiển thị tooltip "Điểm từ 0-10, 1 chữ số thập phân"
  - Actor: Sửa điểm hợp lệ

**A2: Để trống điểm**
- Tại bước 12:
  - Actor: Xóa hết text
  - System: Cho phép (điểm có thể null)
  - Tại bước 15: Xóa điểm khỏi DB nếu đã tồn tại

**A3: Network error khi auto-save**
- Tại bước 15:
  - System: Retry 3 lần
  - Nếu vẫn lỗi:
    - Hiển thị error icon
    - Lưu vào local queue
    - Toast: "Lỗi kết nối. Sẽ tự động lưu khi có mạng"
  - Khi có mạng trở lại:
    - Sync từ queue

---

#### Business Rules
- **BR-33:** Điểm từ 0 đến 10
- **BR-34:** Cho phép 1 chữ số thập phân (ví dụ: 8.5)
- **BR-35:** Có thể để trống (null)
- **BR-36:** Một học sinh chỉ có 1 điểm cho mỗi (môn, loại, học kỳ)
- **BR-37:** Auto-save sau 500ms không thay đổi

#### Validation Rules
```javascript
const isValidScore = (score) => {
  if (score === '' || score === null) return true;
  const num = parseFloat(score);
  if (isNaN(num)) return false;
  if (num < 0 || num > 10) return false;
  if (!/^\d+(\.\d)?$/.test(score)) return false;
  return true;
};
```

---

### UC-11: Nhập Điểm Hàng Loạt

**Use Case ID:** UC-11  
**Use Case Name:** Nhập điểm hàng loạt  
**Priority:** High  
**Actor:** Giáo Viên

**Extend:** UC-10 (Nhập điểm)

---

#### Mô Tả Ngắn Gọn
Giáo viên nhập điểm cho nhiều học sinh rồi lưu tất cả cùng lúc

#### Điều Kiện Tiên Quyết
- Tương tự UC-10

#### Điều Kiện Sau
- Tất cả điểm hợp lệ được lưu
- Điểm lỗi được báo cáo

---

#### Luồng Chính

| Bước | Actor | System |
|------|-------|--------|
| 1-10 | Tương tự UC-10 bước 1-10 | |
| 11 | Nhập điểm cho nhiều học sinh | Validate real-time từng ô |
| 12 | | Đánh dấu các ô hợp lệ/không hợp lệ |
| 13 | Click button "Lưu tất cả" | Validate tất cả điểm đã nhập |
| 14 | | Hiển thị danh sách lỗi nếu có |
| 15 | | Nếu có lỗi, không cho lưu |
| 16 | Sửa các lỗi | |
| 17 | Click "Lưu tất cả" lại | Validate pass |
| 18 | | Hiển thị progress bar |
| 19 | | Gửi POST /api/scores/batch |
| 20 | | Batch insert/update (transaction) |
| 21 | | Response: {success: X, failed: Y, errors: []} |
| 22 | | Hiển thị kết quả: "Đã lưu X điểm" |
| 23 | | Highlight các row thành công (xanh) |
| 24 | | Highlight các row thất bại (đỏ) với lý do |
| 25 | | Trigger tính lại điểm TB cho tất cả HS |

---

#### Luồng Thay Thế

**A1: Tất cả điểm đều lỗi**
- Tại bước 14:
  - System: "Không có điểm hợp lệ nào để lưu"
  - System: Highlight tất cả lỗi
  - Use case quay lại bước 11

**A2: Database error (partial save)**
- Tại bước 20:
  - System: Rollback toàn bộ transaction
  - System: Response error
  - System: "Lỗi khi lưu điểm. Vui lòng thử lại"
  - Data không thay đổi

---

#### Business Rules
- **BR-38:** Sử dụng database transaction cho batch update
- **BR-39:** All or nothing: nếu 1 điểm lỗi trong transaction, rollback tất cả
- **BR-40:** Maximum 100 điểm/batch

---

### UC-12: Sửa Điểm Đã Nhập

**Use Case ID:** UC-12  
**Use Case Name:** Cập nhật điểm  
**Priority:** Critical  
**Actor:** Giáo Viên

**Extend:** UC-10 (Nhập điểm)

---

#### Mô Tả Ngắn Gọn
Giáo viên sửa điểm đã nhập trước đó

#### Điều Kiện Tiên Quyết
- Điểm đã tồn tại trong hệ thống

#### Điều Kiện Sau
- Điểm được cập nhật
- Lịch sử thay đổi được lưu

---

#### Luồng Chính

| Bước | Actor | System |
|------|-------|--------|
| 1-10 | Tương tự UC-10 | Điểm cũ đã được pre-fill |
| 11 | Click vào ô điểm | Select text hiện tại |
| 12 | Sửa điểm | Validate |
| 13 | | So sánh với điểm cũ |
| 14 | | Nếu chênh lệch > 2 điểm, hiển thị warning |
| 15 | | "Điểm thay đổi từ X sang Y. Xác nhận?" |
| 16 | Click "Xác nhận" | |
| 17 | Blur/Enter | Auto-save |
| 18 | | Gửi PUT /api/scores/:id |
| 19 | | Update database |
| 20 | | Insert vào score_history (old, new, user, time) |
| 21 | | Response success |
| 22 | | Hiển thị icon "đã sửa" bên cạnh điểm |
| 23 | | Trigger tính lại điểm TB |

---

#### Luồng Thay Thế

**A1: Không thay đổi điểm**
- Tại bước 13:
  - System: Không gửi request
  - Use case kết thúc

**A2: Hủy confirmation**
- Tại bước 16:
  - Actor: Click "Hủy"
  - System: Revert về điểm cũ
  - Use case kết thúc

---

#### Business Rules
- **BR-41:** Log tất cả thay đổi điểm vào score_history
- **BR-42:** Warning nếu thay đổi > 2 điểm
- **BR-43:** Hiển thị icon "edited" nếu điểm đã từng sửa

---

### UC-13: Xóa Điểm

**Use Case ID:** UC-13  
**Use Case Name:** Xóa điểm  
**Priority:** Medium  
**Actor:** Giáo Viên

---

#### Mô Tả Ngắn Gọn
Giáo viên xóa điểm đã nhập nhầm

#### Điều Kiện Tiên Quyết
- Điểm tồn tại trong database

#### Điều Kiện Sau
- Điểm bị xóa khỏi database
- Điểm TB được tính lại

---

#### Luồng Chính

| Bước | Actor | System |
|------|-------|--------|
| 1 | Hover vào ô điểm | Hiển thị icon X |
| 2 | Click icon X | Hiển thị confirmation |
| 3 | | "Xóa điểm này?" |
| 4 | Click "Xác nhận" | Gửi DELETE /api/scores/:id |
| 5 | | Delete khỏi database |
| 6 | | Log action |
| 7 | | Response success |
| 8 | | Clear ô điểm |
| 9 | | Trigger tính lại điểm TB |

---

#### Business Rules
- **BR-44:** Hard delete (xóa vĩnh viễn)
- **BR-45:** Log action để audit

---

### UC-14: Xem Lịch Sử Thay Đổi Điểm

**Use Case ID:** UC-14  
**Use Case Name:** Xem lịch sử điểm  
**Priority:** Low  
**Actor:** Giáo Viên Chủ Nhiệm

---

#### Mô Tả Ngắn Gọn
Giáo viên xem lịch sử thay đổi của một điểm

#### Điều Kiện Tiên Quyết
- Điểm đã từng bị sửa (có history)

#### Điều Kiện Sau
- Lịch sử được hiển thị

---

#### Luồng Chính

| Bước | Actor | System |
|------|-------|--------|
| 1 | Click icon "history" bên điểm | Gửi GET /api/scores/:id/history |
| 2 | | Response: [{old, new, user, timestamp}] |
| 3 | | Hiển thị modal timeline |
| 4 | Xem lịch sử | Hiển thị: Ngày giờ, Người sửa, Điểm cũ → mới |

---

## MODULE 4: BÁO CÁO & THỐNG KÊ

### UC-15: Xem Dashboard Tổng Quan

**Use Case ID:** UC-15  
**Use Case Name:** Xem dashboard  
**Priority:** High  
**Actor:** Giáo Viên Chủ Nhiệm, Ban Giám Hiệu

---

#### Mô Tả Ngắn Gọn
Người dùng xem dashboard với các thống kê tổng quan về lớp học

#### Điều Kiện Tiên Quyết
- Đã đăng nhập
- Có dữ liệu học sinh và điểm

#### Điều Kiện Sau
- Dashboard hiển thị với các widget và biểu đồ

---

#### Luồng Chính

| Bước | Actor | System |
|------|-------|--------|
| 1 | Click menu "Dashboard" hoặc sau khi login | Hiển thị loading skeleton |
| 2 | | Gửi GET /api/analytics/dashboard |
| 3 | | Query tổng hợp từ database |
| 4 | | Tính toán các metrics: |
| 5 | | - Tổng số HS |
| 6 | | - ĐTB lớp |
| 7 | | - Số HS giỏi (>=8) |
| 8 | | - Số HS khá (6.5-8) |
| 9 | | - Số HS TB (5-6.5) |
| 10 | | - Số HS yếu (<5) |
| 11 | | - Tỷ lệ % từng loại |
| 12 | | Response data |
| 13 | | Render các widget cards |
| 14 | | Render pie chart phân bố học lực |
| 15 | | Render bar chart điểm TB các môn |
| 16 | | Render Top 10 học sinh xuất sắc |
| 17 | | Render danh sách HS cần quan tâm |
| 18 | Xem dashboard | Tương tác với các biểu đồ (hover, click) |

---

#### Luồng Thay Thế

**A1: Chưa có dữ liệu**
- Tại bước 3:
  - System: Response với data = 0
  - System: Hiển thị empty state
  - System: "Chưa có dữ liệu. Hãy thêm học sinh và nhập điểm"

**A2: Refresh dashboard**
- Actor: Click button refresh
- System: Quay lại bước 2

---

#### Business Rules
- **BR-46:** Giỏi: ĐTB >= 8.0
- **BR-47:** Khá: 6.5 <= ĐTB < 8.0
- **BR-48:** Trung bình: 5.0 <= ĐTB < 6.5
- **BR-49:** Yếu: ĐTB < 5.0
- **BR-50:** Cache dashboard data 5 phút

#### UI Components
- 4 summary cards (tổng HS, ĐTB lớp, giỏi/khá/TB/yếu)
- Pie chart với legend
- Bar chart responsive
- Top 10 table với avatar
- "Cần quan tâm" list với badge đỏ

---

### UC-16: Xuất Báo Cáo Cá Nhân Học Sinh

**Use Case ID:** UC-16  
**Use Case Name:** Xuất báo cáo học sinh  
**Priority:** High  
**Actor:** Giáo Viên Chủ Nhiệm

---

#### Mô Tả Ngắn Gọn
Giáo viên xuất báo cáo PDF chi tiết cho một học sinh

#### Điều Kiện Tiên Quyết
- Học sinh có dữ liệu điểm

#### Điều Kiện Sau
- File PDF được tạo và download

---

#### Luồng Chính

| Bước | Actor | System |
|------|-------|--------|
| 1 | Vào trang chi tiết học sinh | Hiển thị button "Xuất báo cáo" |
| 2 | Click "Xuất báo cáo" | Hiển thị modal |
| 3 | | Form nhập nhận xét giáo viên (textarea) |
| 4 | Nhập nhận xét (optional) | |
| 5 | Click "Xuất PDF" | Hiển thị loading |
| 6 | | Fetch tất cả dữ liệu cần thiết |
| 7 | | Generate PDF với template: |
| 8 | | - Logo trường |
| 9 | | - Tiêu đề "Báo cáo học tập" |
| 10 | | - Thông tin học sinh |
| 11 | | - Bảng điểm tất cả môn |
| 12 | | - ĐTB từng môn và ĐTB chung |
| 13 | | - Xếp hạng trong lớp |
| 14 | | - Nhận xét giáo viên |
| 15 | | - Chữ ký (template) |
| 16 | | Download file: BaoCao_[MaHS]_[Date].pdf |
| 17 | Lưu file | |

---

#### Business Rules
- **BR-51:** PDF format A4
- **BR-52:** Font Unicode hỗ trợ tiếng Việt
- **BR-53:** Template chuyên nghiệp, có logo

#### Technical Notes
- Use jsPDF + jsPDF-AutoTable
- Vietnamese font: Roboto hoặc Arial Unicode
- Landscape orientation cho bảng điểm

---

### UC-17: Xuất Báo Cáo Lớp Học

**Use Case ID:** UC-17  
**Use Case Name:** Xuất báo cáo lớp  
**Priority:** Medium  
**Actor:** Giáo Viên Chủ Nhiệm, Ban Giám Hiệu

**Extend:** UC-16

---

#### Mô Tả Ngắn Gọn
Xuất báo cáo tổng hợp toàn lớp với biểu đồ và thống kê

#### Luồng Chính
- Tương tự UC-16 nhưng:
  - Bao gồm tất cả học sinh
  - Thêm biểu đồ phân bố
  - Thêm bảng xếp hạng
  - Multiple pages

---

### UC-18: Xem Bảng Xếp Hạng

**Use Case ID:** UC-18  
**Use Case Name:** Xem bảng xếp hạng  
**Priority:** High  
**Actor:** Giáo Viên, Ban Giám Hiệu

---

#### Mô Tả Ngắn Gọn
Xem bảng xếp hạng học sinh theo điểm TB

#### Luồng Chính

| Bước | Actor | System |
|------|-------|--------|
| 1 | Click menu "Xếp hạng" | GET /api/analytics/rankings |
| 2 | | Calculate rankings |
| 3 | | Response: [{student, avg_score, rank}] |
| 4 | | Render bảng xếp hạng |
| 5 | | Highlight Top 3 với màu khác |
| 6 | | Medal icon cho Top 3 |
| 7 | Xem bảng | Scroll, filter |

---

#### Business Rules
- **BR-54:** Xếp hạng theo ĐTB chung (cao → thấp)
- **BR-55:** Cùng điểm = cùng hạng
- **BR-56:** Top 1: gold, Top 2: silver, Top 3: bronze

---

## MODULE 5: IMPORT/EXPORT

### UC-19: Import Danh Sách Học Sinh Từ Excel

**Use Case ID:** UC-19  
**Use Case Name:** Import học sinh  
**Priority:** Medium  
**Actor:** Giáo Viên Chủ Nhiệm

---

#### Mô Tả Ngắn Gọn
Giáo viên import danh sách học sinh từ file Excel

#### Điều Kiện Tiên Quyết
- File Excel đúng format template

#### Điều Kiện Sau
- Học sinh hợp lệ được import vào DB
- Báo cáo kết quả import

---

#### Luồng Chính

| Bước | Actor | System |
|------|-------|--------|
| 1 | Click "Import học sinh" | Hiển thị modal |
| 2 | Click "Tải file mẫu" | Download template.xlsx |
| 3 | Chuẩn bị file Excel theo mẫu | |
| 4 | Click "Chọn file" | Mở file picker |
| 5 | Chọn file .xlsx hoặc .csv | Validate file extension |
| 6 | | Read file với SheetJS |
| 7 | | Parse dữ liệu |
| 8 | | Validate từng row: |
| 9 | | - Các cột bắt buộc có đầy đủ |
| 10 | | - Format đúng (ngày, email, SĐT) |
| 11 | | - Mã HS không trùng |
| 12 | | Phân loại: hợp lệ / lỗi |
| 13 | | Hiển thị preview table |
| 14 | | Highlight row lỗi màu đỏ |
| 15 | | Hiển thị message lỗi cụ thể |
| 16 | Xem preview | Check dữ liệu |
| 17 | | Hiển thị summary: X hợp lệ, Y lỗi |
| 18 | Click "Import" | Confirmation |
| 19 | Confirm | Gửi POST /api/students/import |
| 20 | | Batch insert (transaction) |
| 21 | | Response: {success: X, failed: Y} |
| 22 | | Hiển thị kết quả chi tiết |
| 23 | | Download error report (nếu có lỗi) |
| 24 | | Refresh danh sách học sinh |

---

#### Luồng Thay Thế

**A1: File sai format**
- Tại bước 7:
  - System: "File không đúng định dạng template"
  - System: Show example screenshot
  - Use case quay lại bước 4

**A2: Tất cả row đều lỗi**
- Tại bước 12:
  - System: "Không có dữ liệu hợp lệ nào"
  - System: Hiển thị tất cả lỗi
  - Use case quay lại bước 4

**A3: Hủy import**
- Tại bước 18:
  - Actor: Click "Hủy"
  - System: Đóng modal
  - Use case kết thúc

---

#### Business Rules
- **BR-57:** File tối đa 5MB
- **BR-58:** Tối đa 500 học sinh/file
- **BR-59:** Template có header row cố định
- **BR-60:** Validate tương tự UC-06

#### Template Columns
```
| Mã HS* | Họ tên* | Ngày sinh* | Giới tính* | Địa chỉ | SĐT PH | Email PH | Ghi chú |
```
(*) = bắt buộc

---

### UC-20: Import Điểm Từ Excel

**Use Case ID:** UC-20  
**Use Case Name:** Import điểm  
**Priority:** Medium  
**Actor:** Giáo Viên

**Similar to:** UC-19

---

#### Luồng Chính
- Chọn môn học, loại điểm trước
- Download template theo môn đã chọn
- Template: Mã HS | Họ tên | Điểm
- Validate: Mã HS tồn tại, Điểm 0-10
- Preview và import

---

### UC-21: Export Danh Sách Học Sinh Ra Excel

**Use Case ID:** UC-21  
**Use Case Name:** Export học sinh  
**Priority:** Medium  
**Actor:** Giáo Viên

---

#### Luồng Chính

| Bước | Actor | System |
|------|-------|--------|
| 1 | Click "Export Excel" | Hiển thị options |
| 2 | Chọn "Tất cả" hoặc "Kết quả hiện tại" | |
| 3 | Click "Export" | Hiển thị loading |
| 4 | | Fetch dữ liệu cần export |
| 5 | | Create workbook với SheetJS |
| 6 | | Add header row với styling |
| 7 | | Add data rows |
| 8 | | Apply formatting: |
| 9 | | - Border cho tất cả cells |
| 10 | | - Bold header |
| 11 | | - Auto-fit column width |
| 12 | | Generate file |
| 13 | | Download: DanhSachHS_YYYYMMDD.xlsx |

---

#### Business Rules
- **BR-61:** Export tất cả columns
- **BR-62:** Format đẹp, professional
- **BR-63:** Filename có timestamp

---

### UC-22: Export Bảng Điểm Ra Excel

**Use Case ID:** UC-22  
**Use Case Name:** Export điểm  
**Priority:** Medium  
**Actor:** Giáo Viên

**Similar to:** UC-21

---

#### Luồng Chính
- Chọn môn học (hoặc tất cả)
- Export bảng điểm
- Conditional formatting: điểm màu theo loại
- Filename: BangDiem_[Mon]_YYYYMMDD.xlsx

---

## 4. Activity Diagrams

### Activity Diagram: Đăng Nhập

```
┌─────────────────────────────────────────────────────────────┐
│                     ĐĂNG NHẬP HỆ THỐNG                      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  (Start)                                                    │
│    │                                                        │
│    ▼                                                        │
│  [Truy cập URL]                                            │
│    │                                                        │
│    ▼                                                        │
│  [Hiển thị form đăng nhập]                                 │
│    │                                                        │
│    ▼                                                        │
│  [Nhập username & password]                                │
│    │                                                        │
│    ▼                                                        │
│  [Click Đăng nhập]                                         │
│    │                                                        │
│    ▼                                                        │
│  ◇ Validate format?                                        │
│    │         │                                              │
│    │ NO      │ YES                                          │
│    ▼         ▼                                              │
│  [Show error] [Gửi request API]                            │
│    │         │                                              │
│    └─────────▼                                              │
│            ◇ Username tồn tại?                              │
│              │         │                                    │
│              │ NO      │ YES                                │
│              ▼         ▼                                    │
│            [Error]  ◇ Password đúng?                        │
│              │         │         │                          │
│              │         │ NO      │ YES                      │
│              │         ▼         ▼                          │
│              │       [Error]  ◇ Account active?             │
│              │         │         │         │                │
│              │         │         │ NO      │ YES            │
│              │         │         ▼         ▼                │
│              │         │       [Error]  [Tạo JWT token]     │
│              │         │         │         │                │
│              │         │         │         ▼                │
│              │         │         │     [Lưu token]          │
│              │         │         │         │                │
│              │         │         │         ▼                │
│              │         │         │     [Redirect Dashboard] │
│              │         │         │         │                │
│              └─────────┴─────────┴─────────▼                │
│                                          (End)              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

### Activity Diagram: Thêm Học Sinh

```
┌─────────────────────────────────────────────────────────────┐
│                    THÊM HỌC SINH MỚI                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  (Start)                                                    │
│    │                                                        │
│    ▼                                                        │
│  [Click "Thêm học sinh"]                                   │
│    │                                                        │
│    ▼                                                        │
│  [Hiển thị form modal]                                     │
│    │                                                        │
│    ▼                                                        │
│  ┌──────────────────────────────┐                          │
│  │ Nhập thông tin:              │                          │
│  │ - Mã HS                      │                          │
│  │ - Họ tên                     │                          │
│  │ - Ngày sinh                  │                          │
│  │ - Giới tính                  │                          │
│  │ - Địa chỉ                    │                          │
│  │ - SĐT, Email PH              │                          │
│  └──────────────────────────────┘                          │
│    │                                                        │
│    ▼                                                        │
│  [Click "Lưu"]                                             │
│    │                                                        │
│    ▼                                                        │
│  ◇ Validate tất cả fields?                                 │
│    │              │                                         │
│    │ FAIL         │ PASS                                    │
│    ▼              ▼                                         │
│  [Show errors] [Gửi POST API]                              │
│    │              │                                         │
│    │              ▼                                         │
│    │            ◇ Mã HS unique?                             │
│    │              │         │                               │
│    │              │ NO      │ YES                           │
│    │              ▼         ▼                               │
│    │            [Error]  [Insert DB]                        │
│    │              │         │                               │
│    │              │         ▼                               │
│    │              │     [Response success]                  │
│    │              │         │                               │
│    │              │         ▼                               │
│    │              │     [Đóng modal]                        │
│    │              │         │                               │
│    │              │         ▼                               │
│    │              │     [Refresh danh sách]                 │
│    │              │         │                               │
│    │              │         ▼                               │
│    │              │     [Show success toast]                │
│    │              │         │                               │
│    └──────────────┴─────────▼                               │
│                            (End)                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

### Activity Diagram: Nhập Điểm Hàng Loạt

```
┌──────────────────────────────────────────────────────────────┐
│                   NHẬP ĐIỂM HÀNG LOẠT                        │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  (Start)                                                     │
│    │                                                         │
│    ▼                                                         │
│  [Chọn môn học, loại điểm, HK]                              │
│    │                                                         │
│    ▼                                                         │
│  [Load danh sách học sinh]                                  │
│    │                                                         │
│    ▼                                                         │
│  ╔════════════════════════════╗                             │
│  ║ FOR each học sinh          ║                             │
│  ║   │                        ║                             │
│  ║   ▼                        ║                             │
│  ║ [Nhập điểm]                ║                             │
│  ║   │                        ║                             │
│  ║   ▼                        ║                             │
│  ║ ◇ Valid?                   ║                             │
│  ║   │       │                ║                             │
│  ║   │ NO    │ YES            ║                             │
│  ║   ▼       ▼                ║                             │
│  ║ [Mark red] [Mark green]    ║                             │
│  ║   │       │                ║                             │
│  ║   └───┬───┘                ║                             │
│  ╚═══════╧════════════════════╝                             │
│          │                                                   │
│          ▼                                                   │
│  [Click "Lưu tất cả"]                                       │
│          │                                                   │
│          ▼                                                   │
│        ◇ Có lỗi nào?                                         │
│          │         │                                         │
│          │ YES     │ NO                                      │
│          ▼         ▼                                         │
│    [Show errors] [Confirm]                                  │
│          │         │                                         │
│          │         ▼                                         │
│          │    [Show progress bar]                           │
│          │         │                                         │
│          │         ▼                                         │
│          │    [Gửi batch POST]                              │
│          │         │                                         │
│          │         ▼                                         │
│          │    ◇ DB transaction?                             │
│          │         │         │                               │
│          │         │ FAIL    │ SUCCESS                       │
│          │         ▼         ▼                               │
│          │    [Rollback]  [Commit]                          │
│          │         │         │                               │
│          │         ▼         ▼                               │
│          │    [Show error] [Highlight success rows]         │
│          │         │         │                               │
│          │         │         ▼                               │
│          │         │    [Trigger recalculate avg]           │
│          │         │         │                               │
│          └─────────┴─────────▼                               │
│                            (End)                             │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

---

## 5. Sequence Diagrams

### Sequence Diagram: Đăng Nhập

```
Actor         UI          Frontend       Backend       Database
  │            │              │              │             │
  │─Click Login│              │              │             │
  │──────────>│              │              │             │
  │            │─Submit form──│              │             │
  │            │────────────>│              │             │
  │            │              │─POST /auth/login          │
  │            │              │────────────>│             │
  │            │              │              │─Query user─│
  │            │              │              │──────────>│
  │            │              │              │◄──────────│
  │            │              │              │  user data│
  │            │              │              │─Verify pwd─│
  │            │              │              │◄─────────>│
  │            │              │              │  bcrypt   │
  │            │              │              │─Create JWT─│
  │            │              │              │           │
  │            │              │◄────────────│             │
  │            │              │  {token, user}            │
  │            │◄────────────│              │             │
  │            │  success     │              │             │
  │            │─Save token───│              │             │
  │            │  localStorage│              │             │
  │◄──────────│              │              │             │
  │ Redirect Dashboard        │              │             │
  │            │              │              │             │
```

---

### Sequence Diagram: Thêm Học Sinh

```
Actor      UI       Frontend    Backend    Database
  │         │           │           │          │
  │─Click Add           │           │          │
  │────────>│           │           │          │
  │         │─Open modal│           │          │
  │         │───────────>           │          │
  │◄────────│           │           │          │
  │ Show form           │           │          │
  │         │           │           │          │
  │─Fill form           │           │          │
  │────────>│           │           │          │
  │         │─Validate──│           │          │
  │         │  (client) │           │          │
  │         │           │           │          │
  │─Click Save          │           │          │
  │────────>│           │           │          │
  │         │─POST /students         │          │
  │         │───────────────────────>│          │
  │         │           │           │─Check unique
  │         │           │           │────────>│
  │         │           │           │◄────────│
  │         │           │           │  OK     │
  │         │           │           │─Insert──│
  │         │           │           │────────>│
  │         │           │           │◄────────│
  │         │           │◄───────────│  success│
  │         │◄───────────  {student} │          │
  │◄────────│           │           │          │
  │ Success toast       │           │          │
  │         │─Refresh list          │          │
  │         │───────────────────────>│          │
  │         │           │◄───────────│          │
  │◄────────│           │  updated list         │
  │         │           │           │          │
```

---

### Sequence Diagram: Nhập Điểm Auto-Save

```
Actor    UI      Frontend   Backend   Database   Calculator
  │       │          │          │         │           │
  │─Type score       │          │         │           │
  │──────>│          │          │         │           │
  │       │─Validate─│          │         │           │
  │       │ (client) │          │         │           │
  │       │          │          │         │           │
  │─Blur/Enter      │          │         │           │
  │──────>│          │          │         │           │
  │       │─Debounce 500ms      │         │           │
  │       │────────>│          │         │           │
  │       │         │─POST /scores       │           │
  │       │         │────────>│         │           │
  │       │         │         │─Insert/Update        │
  │       │         │         │────────>│           │
  │       │         │         │◄────────│           │
  │       │         │◄────────│  OK     │           │
  │       │◄────────│         │         │           │
  │◄──────│ Show checkmark     │         │           │
  │       │         │         │─Trigger calc         │
  │       │         │         │─────────────────────>│
  │       │         │         │         │  Calculate avg
  │       │         │         │◄─────────────────────│
  │       │         │         │  new avg & rank      │
  │       │         │         │─Update─>│           │
  │       │         │         │◄────────│           │
  │       │         │◄────────│         │           │
  │       │◄────────│ Updated avg       │           │
  │◄──────│         │         │         │           │
  │ UI updated      │         │         │           │
  │       │         │         │         │           │
```

---

## 6. Business Rules

### BR Summary Table

| ID | Rule | Module | Priority |
|----|------|--------|----------|
| BR-01 | Username không phân biệt hoa thường | Auth | High |
| BR-02 | Password tối thiểu 6 ký tự | Auth | High |
| BR-03 | Token hết hạn sau 7 ngày | Auth | High |
| BR-04 | Khóa tài khoản sau 5 lần sai | Auth | Medium |
| BR-05 | Session timeout 24h | Auth | Medium |
| BR-06 | Token blacklist sau logout | Auth | High |
| BR-07 | Không reuse token sau logout | Auth | High |
| BR-08 | Reset token hết hạn 1h | Auth | High |
| BR-09 | Reset token dùng 1 lần | Auth | High |
| BR-10 | Password mới khác cũ | Auth | Low |
| BR-11 | Password tối thiểu 6 ký tự | Auth | High |
| BR-12 | 20 học sinh/trang | Student | Medium |
| BR-13 | Sort mặc định tên A-Z | Student | Low |
| BR-14 | Chỉ hiển thị is_deleted=false | Student | High |
| BR-15 | Search không phân biệt hoa thường | Student | Medium |
| BR-16 | Search theo tên hoặc mã | Student | Medium |
| BR-17 | Debounce search 300ms | Student | Low |
| BR-18 | Mã HS unique toàn hệ thống | Student | Critical |
| BR-19 | Mã HS không ký tự đặc biệt | Student | High |
| BR-20 | Họ tên 2-100 ký tự | Student | High |
| BR-21 | Học sinh >= 5 tuổi | Student | High |
| BR-22 | SĐT 10 số, bắt đầu 0 | Student | Medium |
| BR-23 | Email format RFC 5322 | Student | Medium |
| BR-24 | Không sửa mã HS | Student | Critical |
| BR-25 | Log mọi thay đổi audit_log | Student | High |
| BR-26 | Validate giống thêm mới | Student | High |
| BR-27 | Soft delete (is_deleted=true) | Student | Critical |
| BR-28 | Giữ dữ liệu điểm khi xóa | Student | Critical |
| BR-29 | Có thể restore | Student | Medium |
| BR-30 | Log xóa để audit | Student | High |
| BR-31 | Chỉ GVCN restore | Student | High |
| BR-32 | Giữ nguyên data khi restore | Student | High |
| BR-33 | Điểm 0-10 | Score | Critical |
| BR-34 | 1 chữ số thập phân | Score | High |
| BR-35 | Cho phép null | Score | High |
| BR-36 | Unique (HS, môn, loại, HK) | Score | Critical |
| BR-37 | Auto-save 500ms | Score | Medium |
| BR-38 | Transaction cho batch | Score | Critical |
| BR-39 | All or nothing batch | Score | Critical |
| BR-40 | Max 100 điểm/batch | Score | Medium |
| BR-41 | Log thay đổi điểm | Score | High |
| BR-42 | Warning nếu đổi >2 điểm | Score | Medium |
| BR-43 | Icon "edited" nếu đã sửa | Score | Low |
| BR-44 | Hard delete điểm | Score | High |
| BR-45 | Log xóa điểm | Score | High |
| BR-46 | Giỏi: ĐTB >= 8.0 | Analytics | High |
| BR-47 | Khá: 6.5 <= ĐTB < 8.0 | Analytics | High |
| BR-48 | TB: 5.0 <= ĐTB < 6.5 | Analytics | High |
| BR-49 | Yếu: ĐTB < 5.0 | Analytics | High |
| BR-50 | Cache dashboard 5 phút | Analytics | Medium |
| BR-51 | PDF format A4 | Report | Medium |
| BR-52 | Font Unicode tiếng Việt | Report | High |
| BR-53 | Template chuyên nghiệp | Report | Medium |
| BR-54 | Ranking theo ĐTB (cao→thấp) | Analytics | Critical |
| BR-55 | Cùng điểm = cùng hạng | Analytics | Critical |
| BR-56 | Top 3: gold/silver/bronze | Analytics | Low |
| BR-57 | File max 5MB | Import | Medium |
| BR-58 | Max 500 HS/file | Import | Medium |
| BR-59 | Template có header cố định | Import | High |
| BR-60 | Validate như thêm mới | Import | High |
| BR-61 | Export all columns | Export | Medium |
| BR-62 | Format professional | Export | Medium |
| BR-63 | Filename có timestamp | Export | Low |

---

## 7. Data Dictionary

### Table: students

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| id | SERIAL | PRIMARY KEY | ID tự tăng |
| student_code | VARCHAR(20) | UNIQUE, NOT NULL | Mã học sinh |
| full_name | VARCHAR(100) | NOT NULL | Họ và tên |
| date_of_birth | DATE | NOT NULL | Ngày sinh |
| gender | VARCHAR(10) | | Nam/Nữ |
| address | TEXT | | Địa chỉ |
| parent_phone | VARCHAR(15) | | SĐT phụ huynh |
| parent_email | VARCHAR(100) | | Email PH |
| notes | TEXT | | Ghi chú |
| is_deleted | BOOLEAN | DEFAULT FALSE | Soft delete flag |
| created_at | TIMESTAMP | DEFAULT NOW() | Ngày tạo |
| updated_at | TIMESTAMP | DEFAULT NOW() | Ngày cập nhật |

---

### Table: scores

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| id | SERIAL | PRIMARY KEY | ID tự tăng |
| student_id | INTEGER | FK students(id) | ID học sinh |
| subject_id | INTEGER | FK subjects(id) | ID môn học |
| score_type | VARCHAR(10) | NOT NULL | KTM/KT15/KT1T/THHK |
| score | DECIMAL(3,1) | CHECK 0-10 | Điểm số |
| semester | INTEGER | CHECK 1 or 2 | Học kỳ |
| school_year | VARCHAR(10) | | Năm học |
| created_at | TIMESTAMP | DEFAULT NOW() | Ngày tạo |
| updated_at | TIMESTAMP | DEFAULT NOW() | Ngày cập nhật |

**Unique Constraint:** (student_id, subject_id, score_type, semester, school_year)

---

### Table: subjects

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| id | SERIAL | PRIMARY KEY | ID tự tăng |
| subject_name | VARCHAR(50) | NOT NULL | Tên môn (Toán, Văn...) |
| subject_code | VARCHAR(10) | UNIQUE | Mã môn (MATH, LIT...) |

---

### Table: users

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| id | SERIAL | PRIMARY KEY | ID tự tăng |
| username | VARCHAR(50) | UNIQUE, NOT NULL | Tên đăng nhập |
| password_hash | VARCHAR(255) | NOT NULL | Password đã hash |
| full_name | VARCHAR(100) | | Họ tên |
| email | VARCHAR(100) | | Email |
| role | VARCHAR(20) | DEFAULT 'teacher' | Role: teacher/admin |
| created_at | TIMESTAMP | DEFAULT NOW() | Ngày tạo |

---

### Table: audit_log (Optional)

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| id | SERIAL | PRIMARY KEY | ID tự tăng |
| user_id | INTEGER | FK users(id) | Người thực hiện |
| action | VARCHAR(50) | | CREATE/UPDATE/DELETE |
| table_name | VARCHAR(50) | | Bảng bị ảnh hưởng |
| record_id | INTEGER | | ID record |
| old_value | JSONB | | Giá trị cũ |
| new_value | JSONB | | Giá trị mới |
| timestamp | TIMESTAMP | DEFAULT NOW() | Thời gian |

---

## Appendix: Use Case Index

### By Priority

**Critical (P0):**
- UC-01: Đăng nhập
- UC-04: Xem danh sách học sinh
- UC-06: Thêm học sinh
- UC-07: Sửa học sinh
- UC-10: Nhập điểm

**High (P1):**
- UC-02: Đăng xuất
- UC-05: Tìm kiếm học sinh
- UC-08: Xóa học sinh
- UC-11: Nhập điểm hàng loạt
- UC-12: Sửa điểm
- UC-15: Dashboard
- UC-16: Báo cáo cá nhân
- UC-18: Bảng xếp hạng

**Medium (P2):**
- UC-03: Quên mật khẩu
- UC-09: Khôi phục học sinh
- UC-13: Xóa điểm
- UC-17: Báo cáo lớp
- UC-19: Import học sinh
- UC-20: Import điểm
- UC-21: Export học sinh
- UC-22: Export điểm

**Low (P3):**
- UC-14: Lịch sử điểm

---

**Document Version:** 1.0  
**Last Updated:** 31/01/2026  
**Total Use Cases:** 22  
**Total Business Rules:** 63
