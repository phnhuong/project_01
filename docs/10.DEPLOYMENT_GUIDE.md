# Production Deployment Guide - Hệ Thống Quản Lý Học Sinh

---

## Thông Tin Tài Liệu

**Dự án:** Hệ Thống Quản Lý Học Sinh  
**Môi trường:** Production Environment  
**Hệ điều hành:** Ubuntu 22.04 LTS (Single Server)  
**Platform:** Direct Deployment (Node.js + PM2 + Nginx)  
**Ngày cập nhật:** 10/02/2026  
**Phiên bản:** 2.1

---

## Mục Lục

1. [Overview](#1-overview)
2. [Prerequisites](#2-prerequisites)
3. [Server Setup](#3-server-setup)
4. [Database Setup](#4-database-setup)
5. [Application Deployment](#5-application-deployment)
6. [Nginx Configuration](#6-nginx-configuration)
7. [SSL Setup](#7-ssl-setup)
8. [Maintenance](#8-maintenance)

---

## 1. Overview

This guide details the deployment of the Student Management System on a **single Ubuntu 22.04 LTS server**.

### Architecture
All components run directly on the host operating system:
- **Web Server:** Nginx (System Service) - Serves static React files & Reverse Proxies API.
- **Backend:** Node.js 20 (Managed by PM2).
- **Database:** PostgreSQL 16 (System Service).

Communication happens via **localhost (127.0.0.1)**.

---

## 2. Prerequisites

### Server Requirements
- **OS:** Ubuntu 22.04 LTS
- **Minimum Specs:** 2 CPU, 4GB RAM, 20GB SSD
- **Access:** SSH with sudo privileges

### Software Requirements
- Node.js 20.x LTS
- PostgreSQL 16.x
- Nginx
- PM2 (Global install)
- Git

---

## 3. Server Setup

### 3.1 Update System & Install Dependencies
```bash
# Update system
sudo apt update && sudo apt upgrade -y

# Install essential tools
sudo apt install -y curl wget git vim build-essential

# Install Node.js 20
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs

# Install PM2 globally
sudo npm install -g pm2
```

### 3.2 Install PostgreSQL
```bash
# Add Postgres repo
sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list'
wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -
sudo apt update

# Install Postgres 16
sudo apt install -y postgresql-16 postgresql-contrib-16
sudo systemctl enable postgresql
sudo systemctl start postgresql
```

### 3.3 Install Nginx
```bash
sudo apt install -y nginx
sudo systemctl enable nginx
sudo systemctl start nginx
```

---

## 4. Database Setup

### 4.1 Configuration
```bash
# Create Database and User
sudo -u postgres psql
```

```sql
-- Inside psql shell
CREATE DATABASE student_management;
CREATE USER admin_user WITH ENCRYPTED PASSWORD 'StrongPassword123!';
GRANT ALL PRIVILEGES ON DATABASE student_management TO admin_user;
\q
```

---

## 5. Application Deployment

### 5.1 Clone Repository
```bash
cd /home/admin123
git clone https://github.com/your-org/student-management.git qlhs_02
cd qlhs_02
```

### 5.2 Backend Setup
```bash
cd backend
# Install dependencies
npm install

# Setup Env
cp .env.example .env
nano .env
# Edit DATABASE_URL=postgresql://admin_user:StrongPassword123!@localhost:5432/student_management

# Run Migrations
npx prisma migrate deploy

# Start with PM2
pm2 start ecosystem.config.js
pm2 save
pm2 startup
```

### 5.3 Frontend Setup
```bash
cd ../frontend
# Install dependencies
npm install

# Setup Env
cp .env.example .env
nano .env
# Set VITE_API_URL=https://your-domain.com/api

# Build
npm run build
```

---

## 6. Nginx Configuration

### 6.1 Configure Site
```bash
sudo nano /etc/nginx/sites-available/student-management
```

```nginx
server {
    listen 80;
    server_name your-domain.com;

    root /home/admin123/qlhs_02/frontend/dist;
    index index.html;

    # Frontend
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Backend API
    location /api {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### 6.2 Enable Site
```bash
sudo ln -s /etc/nginx/sites-available/student-management /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

---

## 7. SSL Setup (Let's Encrypt)
```bash
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d your-domain.com
```

---

## 8. Maintenance

### 8.1 Updates
```bash
# Pull latest code
git pull

# Backend Update
cd backend
npm install
npx prisma migrate deploy
pm2 restart all

# Frontend Update
cd ../frontend
npm install
npm run build
```

### 8.2 Backups
- **Database**: Use `pg_dump` to backup PostgreSQL.
- **Files**: Backup `uploads/` directory.

### 8.3 Process Management
```bash
pm2 list          # Check status
pm2 logs          # View live logs
pm2 reload all    # Zero-downtime reload
```

---

## 9. Further Reading
For more detailed information on maintaining the codebase and standard development patterns, see the **[11. Maintenance & Operation Guide](./11.MAINTENANCE_GUIDE.md)**.
